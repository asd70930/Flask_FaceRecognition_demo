{% extends "mybase.html" %}
{% block title %}{% endblock %}
{% block page_content %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<style>
.img-zone{
    height: 250px; /*can be anything*/
    position: relative;
    background-color: rgba(116, 116, 116, 0.1);
}
img {
    max-height: 100%;
    max-width: 100%;
    width: auto;
    height: auto;
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    margin: auto;
}
.answer{
    padding:5px 5px 5px 5px;
}
.my_select{
    width:250px;
}
.bt_font{
    font-size:14px;
}
</style>

<div class="container mt-1 backgroundGray">
    <div class="row align-items-center">
        <div class="col-5 ">
            <div class="px-5 py-4 text-center">
                <p Align="Left" style="font-size:18px;">上傳圖片至後端資料庫</p>
                <div class="d-flex flex-row">
                    <p style="font-size:12px;">請輸入檔名：</p>
                    <textarea class="mb-3" id="testarea_upimgfile" rows="1"></textarea>
                </div>
                <div class="d-flex flex-row">
                    <p style="font-size:12px;">選擇群組：</p>
                    <select id="vip_group" size="1">
                        <option>VIP</option>
                        <option>VVIP</option>
                        <option>黑名單</option>
                    </select>
                </div>
                <div class="mt-3 d-flex flex-row">
                    <label id="bt1" class="btn btn-primary bt_font">
                            選擇圖片<input class="" hidden id="uploadimg1" type="file" accept="image/*">
                    </label>
                    <button class="btn btn-primary ml-3 bt_font" onclick="upload_img1()">上傳圖片</button>
                </div>
            </div>
            <hr>
            <div class="px-5 pb-5 ">
                <textarea class="form-control mb-3" id="textarea_getipc1" rows="1"></textarea>
                <div class="btn btn-primary bt_font" onclick="show_camera">
                        開啟攝影機
                </div>
            </div>
        </div>
        <div class="col-7">
            <div class="img-zone">
                <img id="blsh1" src="{{ basea }}" height="200"  alt="一張圖片">
            </div>
        </div>
    </div>
    <hr>
    <div class="row align-items-center text-center">
        <div class="col-5 ">
            <p style="font-size:18px;">顯示資料庫圖片</p>
            <select class="my_select" name="cars" multiple size="10">
                <option value="volvo">Volvo</option>
                <option value="bmw">BMW</option>
                <option value="saab">Saab</option>
                <option value="benz">Benz</option>
                <option value="audi">Audi</option>
            </select>
        </div>
        <div class="col-7">
            <div class="img-zone">
                <img id="blsh2" src="{{ baseb }}" height="200"  alt="一張圖片">
            </div>
        </div>
    </div>
    <hr>

    <div class="row align-items-center">
        <div class="col-5 ">
            <div class="px-5 py-4">
                <p style="font-size:18px;">開始比對</p>
                <label class="btn btn-primary bt_font">
                        上傳圖片<input class="" hidden id="uploadimg2" type="file" accept="image/*">
                </label>
            </div>
            <div class="px-5 pb-5 ">
                <textarea class="form-control mb-3" id="textarea_getipc2" rows="1"></textarea>
                <div class="btn btn-primary bt_font" onclick="show_camera">
                        開啟攝影機
                </div>
            </div>
        </div>
        <div class="col-7 ">
            <div class="img-zone">
                <img id="blsh3" src="{{ baseb }}" height="200"  alt="一張圖片">
            </div>
        </div>

    </div>

</div>

<script>
    var filesizeLimit = 2 * 1024 * 1024

    <!-- var filesizeLimit = 1024-->
    function readURL(input) {
        if (input.files && input.files[0]) {
            if (filesizeLimit <= input.files[0].size) {
                alert("圖片檔案無法上傳大於2MB");
            }
            else{
                var reader = new FileReader();
                reader.onload = function (e) {
                    $('#blsh1').attr('src', e.target.result);
                }
                var filename = input.files[0].name.split(".",1)[0]
                reader.readAsDataURL(input.files[0]); // convert to base64 string
            }
        }
    }

    $("#uploadimg1").change(function () {
        readURL(this);
    });


    function upload_img1() {
        var XHR = new XMLHttpRequest();
        imgs = {};
        var aimg = document.getElementById("blsh1");
        var aimgsrc = aimg.getAttribute("src");
        var process = document.getElementById("processing");
        imgs["a"] = aimgsrc
        var vip = $("#vip_group option:selected").text();
        var filename =$("#testarea_upimgfile").val();
        filename = filename + "_" + vip
        imgs["filename"] = filename
        var pay_load = {
            "imgs": imgs
        };

        XHR.onreadystatechange = function () {
            if (XHR.readyState == XMLHttpRequest.DONE) {
                document.getElementById("bt1").disabled=false;
                var data = XHR.responseText;
                var jsonResponse = JSON.parse(data);
                var state = jsonResponse["state"]
                switch (state) {
                    case 1:
                        alert("儲存圖片成功！");
                        aimg.setAttribute("src", jsonResponse["base"]);
                        break;
                    case 2:
                        alert("圖片中超過一個人臉！不儲存圖片！");
                        aimg.setAttribute("src", jsonResponse["base"]);
                        break;
                    case 0:
                        alert("圖片中找不到人臉！不儲存圖片！");
                        break;
                    default:
                        alert('something error');
                        break;
                }
            }
            else{
                document.getElementById("bt1").disabled=true;
            }

        }
        // 配置请求
        XHR.open('POST', 'upload_img', true);
        // HTTP头
        XHR.setRequestHeader('content-type', 'application/json'); //先open再设置请求头
        // 发送请求
        XHR.send(JSON.stringify(pay_load));


    }


</script>

{% endblock %}